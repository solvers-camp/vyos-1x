{# j2lint: disable=S6 #}
### Generated by VyOS image-tools v.{{ tools_version }} ###
{% macro menu_name(mode) -%}
{% if mode == 'normal' -%}
    VyOS
{%- elif mode == 'pw_reset' -%}
    Lost password change
{%- else -%}
    Unknown
{%- endif %}
{%- endmacro %}
{% macro console_name(type) -%}
{% if type == 'tty' -%}
    KVM
{%- elif type == 'ttyS' -%}
    Serial
{%- else -%}
    Unknown
{%- endif %}
{%- endmacro %}
{% macro console_opts(type) -%}
{% if type == 'tty' -%}
    console=ttyS0,{{ console_speed }} console=tty0
{%- elif type == 'ttyS' -%}
    console=tty0 console=ttyS0,{{ console_speed }}
{%- else -%}
    console=tty0 console=ttyS0,{{ console_speed }}
{%- endif %}
{%- endmacro %}
{% macro passwd_opts(mode) -%}
{% if mode == 'pw_reset' -%}
    init=/opt/vyatta/sbin/standalone_root_pw_reset
{%- endif %}
{%- endmacro %}
set default={{ default }}
set timeout={{ timeout }}
{% if console_type == 'ttyS' %}
{%     if console_num == '0' %}
serial --unit=0 --speed={{ console_speed }}
{%     else %}
serial --unit={{ console_num }} --speed=115200
{%     endif %}
{% else %}
serial --unit=0 --speed={{ console_speed }}
{% endif %}
terminal_output --append serial
terminal_input serial console
{% for mod in modules %}
insmod {{ mod }}
{% endfor %}
{% if root %}
set root={{ root }}
{% endif %}
{% if search_root %}
{{ search_root }}
{% endif %}

{% for v in versions %}
menuentry "{{ menu_name(v.bootmode) }} {{ v.version }} ({{ console_name(v.console_type) }} console)" {
    linux /boot/{{ v.version }}/vmlinuz {{ v.boot_opts }} {{ console_opts(v.console_type) }} {{ passwd_opts(v.bootmode) }}
    initrd /boot/{{ v.version }}/initrd.img
}
{% endfor %}
