# Generated by ${vyos_conf_scripts_dir}/service_monitoring_zabbix-agent.py

PidFile=/run/zabbix/zabbix_agent2.pid
LogFile=/var/log/zabbix/zabbix_agent2.log
ControlSocket=/run/zabbix/agent.sock

{% if log is vyos_defined %}
{%     if log.size is vyos_defined %}
### Option: LogFileSize
#       Maximum size of log file in MB.
#       0 - disable automatic log rotation.
#
# Range: 0-1024
LogFileSize={{ log.size }}
{%     endif %}
{%     if log.remote_commands is vyos_defined %}
LogRemoteCommands=1
{%     endif %}
{%     if log.debug_level is vyos_defined %}
{%         set mapping = {
              'basic': 0,
              'critical': 1,
              'error': 2,
              'warning': 3,
              'debug': 4,
              'extended-debug': 5
           } %}
DebugLevel={{ mapping[log.debug_level] }}
{%     endif %}
{% endif %}

{% if server is vyos_defined %}
Server={{ server | bracketize_ipv6 | join(',') }}
{% endif %}
{% if server_active is vyos_defined %}
{%     set servers = [] %}
{%     for key, value in server_active.items() %}
{%         if value.port %}
{%             set serv_item = key | bracketize_ipv6 + ':' + value.port %}
{%             set _ = servers.append(serv_item) %}
{%         else %}
{%             set _ = servers.append(key | bracketize_ipv6) %}
{%         endif %}
{%     endfor %}
ServerActive={{ servers | join(',') }}
{% endif %}

{% if host_name is vyos_defined %}
Hostname={{ host_name }}
{% endif %}

{% if port is vyos_defined %}
ListenPort={{ port }}
{% endif %}
{% if listen_address is vyos_defined %}
ListenIP={{ listen_address | join(',') }}
{% endif %}

{% if limits is vyos_defined %}
{%     if limits.buffer_flush_interval is vyos_defined %}
BufferSend={{ limits.buffer_flush_interval }}
{%     endif %}
{%     if limits.buffer_size is vyos_defined %}
BufferSize={{ limits.buffer_size }}
{%     endif %}
{% endif %}

{% if directory is vyos_defined %}
### Option: Include
#       You may include individual files or all files in a directory in the configuration file.
Include={{ directory }}/*.conf
{% endif %}

{% if timeout is vyos_defined %}
Timeout={{ timeout }}
{% endif %}

